<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>DECLASSIFIED - Cold War Intel Map</title>
    <meta name="description" content="With The Cold War Collectables Map you can track your progress on which intel you still need to collect.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="assets/style/style.css">
    <link rel="icon" href="./favicon-32x32.png" type="image/png">


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

</head>

<body onload="onLoad()">
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <Section>
        <header>
            <div class="dropdown dropbtn">
                Die Maschine
                <div class="dropdown-content">
                    <div class="dropdown-item not-selectable" onClick="setMap(dieMaschine,this,true)">Die Maschine Surface</div>
                    <div class="dropdown-item not-selectable" onClick="setMap(dieMaschine_underground,this,true)">Die Maschine Underground</div>
                </div>
            </div>

            <div class="dropdown dropbtn">
                Firebase Z
                <div class="dropdown-content">
                    <div class="dropdown-item not-selectable" onClick="setMap(firebaseZ_spawn,this,true)">Firebase Z Spawn</div>
                    <div class="dropdown-item not-selectable" onClick="setMap(firebaseZ,this,true)">Firebase Z Main Base</div>
                </div>
            </div>

            <div class="not-selectable" onClick="setMap(duga,this)">Duga</div>
            <div class="not-selectable" onClick="setMap(ruka,this)">Ruka</div>
            <div class="current-map not-selectable" onClick="setMap(golova,this)">Golova</div>
            <div class="not-selectable" onClick="setMap(sanatorium,this)">Sanatorium</div>
            <div class="not-selectable" onClick="setMap(alpine,this)">Alpine</div>
        </header>
        <aside>
            <div id="requiem">
                <h1 class="title not-selectable" onload="" onclick="toggleList(this)">
                    <img src="./assets/img/icons/faction-requiem-icon.png">
                    <t>Requiem</t><span>+</span></h1>
                <div class="itemList">
                </div>
            </div>
            <div id="omega">
                <h1 class="title not-selectable" onload="" onclick="toggleList(this)">
                    <img src="./assets/img/icons/faction-omega-icon.png">
                    <t>Omega</t>
                    <span>+</span>
                </h1>
                <div class="itemList">
                </div>
            </div>
            <div id="maxis">
                <h1 class="title not-selectable" onload="" onclick="toggleList(this)">
                    <img src="./assets/img/icons/faction-maxis-icon.png">
                    <t>Maxis</t><span>+</span></h1>
                <div class="itemList">
                </div>
            </div>
            <div id="darkAether">
                <h1 class="title not-selectable" onload="" onclick="toggleList(this)">
                    <img src="./assets/img/icons/faction-darkAether-icon.png">
                    <t>Dark Aether</t><span>+</span></h1>
                <div class="itemList">
                </div>
            </div>

        </aside>

        <div id="worldMap"></div>
    </Section>
    <input id="cb" type="text" hidden>
    <script src="" async defer></script>
    <script src="assets/js/icons.js"></script>
    <script src="poi/poi.js"></script>
    <script src="assets/js/maps.js"></script>
    <script src="poi/misc.js"></script>
    <script src="assets/js/index.js"></script>
    <script>
        var currentMap = golova;
        var debug = true

        function setMap(x, y, z = false) {
            if (currentMap != x) {
                map.removeLayer(currentMap.Layer)
                map.addLayer(x.Layer)
                currentMap = x

                Array.from(document.getElementsByClassName('current-map'))
                    .forEach((element) => {
                        element.classList.toggle("current-map");
                    })
                if (z) y.parentNode.parentNode.classList.toggle("current-map")
                y.classList.toggle("current-map")
            }
        }

        function onLoad() {
            generateList()
        }
        map.on("click", function(e) {
            if (debug) {
                var cb = document.getElementById("cb");
                cb.value = "[" + e.latlng.lat + ", " + e.latlng.lng + "]";
                cb.style.display = 'block';
                cb.select();
                document.execCommand('copy');
                cb.style.display = 'none';
            }
        })

        function generateList() {



            for (let faction in poi) {
                if (poi.hasOwnProperty(faction)) {
                    let factionIcon = window[faction.toString() + "Icon"]
                    for (let i = 0; i <= Object.keys(poi[faction]).length; i++) {
                        let season = poi[faction][i];
                        for (let typeOfIntel in season) {
                            if (season.hasOwnProperty(typeOfIntel)) {
                                for (let j = 0; j < Object.keys(season[typeOfIntel]).length; j++) {
                                    let intel = season[typeOfIntel][j + 1];

                                    mapLayer = window[intel.map]
                                    let title = intel.name
                                    let desc = intel.desc
                                    let loc = intel.loc


                                    let item = document.createElement("div")
                                    let itemTitle = document.createElement("h2")
                                    let itemTitleText = document.createTextNode(title)
                                    let text = document.createTextNode(desc)
                                    let button = document.createElement("button")
                                    let buttonText = document.createTextNode("Locate")
                                    button.onclick = function() {
                                        map.flyTo(loc, 5);
                                    }
                                    button.appendChild(buttonText)
                                    itemTitle.appendChild(itemTitleText)


                                    item.classList.add("item")
                                    itemTitle.classList.add("itemTitle")
                                    item.appendChild(itemTitle)
                                    item.appendChild(text)
                                    item.appendChild(button)

                                    document.getElementById(faction).children[1].appendChild(item)


                                }
                            }
                        }
                    }
                }
            }



        }

        function toggleList(x) {
            if (x.children[0].innerHTML == "+") {
                x.children[0].innerHTML = "-"
            } else {
                x.children[0].innerHTML = "+"
            }
            x.parentNode.children[1].classList.toggle("visible");
        }
    </script>
</body>

</html>